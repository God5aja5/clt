{% extends "admin/base.html" %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">Order Details: {{ order.order_id }}</h1>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Order Information</h2>
        <div class="space-y-2">
            <p><span class="font-semibold">Order ID:</span> {{ order.order_id }}</p>
            <p><span class="font-semibold">Status:</span> 
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                     {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800
                     {% elif order.status == 'completed' %}bg-green-100 text-green-800
                     {% elif order.status == 'contacted' %}bg-blue-100 text-blue-800
                     {% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ order.status|title }}
                </span>
            </p>
            <p><span class="font-semibold">Date:</span> {{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p><span class="font-semibold">Total Amount:</span> ₹{{ "%.2f"|format(order.total_amount) }}</p>
        </div>
        
        <div class="mt-4">
            <form method="POST" action="{{ url_for('admin.update_order_status', order_id=order.order_id) }}" class="flex items-center space-x-2">
                <label class="font-semibold">Update Status:</label>
                <select name="status" class="border rounded px-2 py-1">
                    <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                    <option value="contacted" {% if order.status == 'contacted' %}selected{% endif %}>Contacted</option>
                    <option value="completed" {% if order.status == 'completed' %}selected{% endif %}>Completed</option>
                </select>
                <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded">Update</button>
            </form>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Customer Information</h2>
        <div class="space-y-2">
            <p><span class="font-semibold">Name:</span> {{ order.full_name }}</p>
            <p><span class="font-semibold">Email:</span> {{ order.email }}</p>
            <p><span class="font-semibold">Phone:</span> {{ order.phone_number }}</p>
            {% if order.telegram_username %}
            <p><span class="font-semibold">Telegram:</span> {{ order.telegram_username }}</p>
            {% endif %}
        </div>
        
        <div class="mt-4 flex space-x-3">
            <a href="tel:{{ order.phone_number }}" 
               class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm flex items-center">
                <i class="fas fa-phone-alt mr-1"></i> Call
            </a>
            <a href="mailto:{{ order.email }}" 
               class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm flex items-center">
                <i class="fas fa-envelope mr-1"></i> Email
            </a>
            {% if order.telegram_username %}
            <a href="https://t.me/{{ order.telegram_username.lstrip('@') }}" 
               class="bg-blue-400 hover:bg-blue-500 text-white px-3 py-2 rounded text-sm flex items-center" target="_blank">
                <i class="fab fa-telegram mr-1"></i> Telegram
            </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">Order Items</h2>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Unit Price</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Subtotal</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for item in order.product_details %}
                <tr>
                    <td class="px-4 py-3 text-sm">{{ item.product.title }}</td>
                    <td class="px-4 py-3 text-sm">{{ item.quantity }}</td>
                    <td class="px-4 py-3 text-sm">₹{{ "%.2f"|format(item.unit_price) }}</td>
                    <td class="px-4 py-3 text-sm">₹{{ "%.2f"|format(item.subtotal) }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="bg-gray-50">
                <tr>
                    <td colspan="3" class="px-4 py-3 text-sm font-semibold text-right">Total:</td>
                    <td class="px-4 py-3 text-sm font-semibold">₹{{ "%.2f"|format(order.total_amount) }}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

{% if order.message %}
<div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-3">Customer Message</h2>
    <div class="bg-gray-50 p-4 rounded border">
        {{ order.message }}
    </div>
</div>
{% endif %}
{% endblock %}